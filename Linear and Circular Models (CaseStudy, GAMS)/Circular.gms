sets
a        /1*4/
i       /1*43/
j       /1*7/
k       /1*9/
l       /1*4/
r       /1*4/
w       /1*4/
u        /1*2/
;

scalars

S        /0.5/
delta        /0.85/
alpha    /1.81875/
beta     /0.69768/
M        /10000000000/
p        /25/
C1       /74.65725168/
C11      /74.65725168/
C2       /149.3145034/
C3       /99.90896916/
C4       /199.8179383/
C5       /99.90896916/
landa    /0.03/
teta     /0.3/
;

parameters
nn(a)    /1      407.511,2       553.969,3       212.205,4       25102.368/
wh(w)   /1      87700,2         558460,3        2436750,4       7064620/
cw(w)    /1      50976,2         114000,3        1258992,4       198420/
;


table dij(i,j)
         1            2            3            4            5            6            7
1        1.333        2.000        2.267        2.227        2.000        1.378        2.289
2        0.889        2.156        2.356        2.244        1.756        1.644        2.400
3        0.156        1.667        1.644        1.511        1.267        0.556        1.667
4        0.067        1.467        1.422        1.333        1.244        0.533        1.444
5        0.289        1.600        1.600        1.467        1.489        0.756        1.622
6        0.711        0.556        0.844        0.667        1.911        1.178        0.800
7        0.800        0.933        0.933        0.556        1.800        1.267        0.711
8        1.200        0.667        0.356        0.911        2.400        1.667        1.333
9        1.333        0.200        0.844        1.333        2.578        1.844        1.511
10       1.573        0.133        1.044        1.578        2.778        2.044        1.711
11       1.667        0.356        1.333        1.867        2.711        2.000        2.000
12       1.667        0.156        1.156        1.667        2.778        2.067        1.822
13       1.333        0.822        0.156        0.667        2.556        1.800        1.400
14       0.533        1.178        1.222        1.111        1.733        1.000        1.244
15       1.667        1.178        0.200        0.756        2.644        2.156        1.444
16       1.547        1.044        0.089        0.667        2.778        2.000        1.311
17       1.547        1.089        0.133        0.667        2.822        2.067        1.356
18       1.773        1.289        0.333        0.889        3.022        2.267        1.578
19       1.773        1.333        0.333        0.600        2.489        2.289        1.289
20       1.640        1.311        0.333        0.289        2.867        2.133        0.978
21       1.547        2.000        0.667        0.133        1.889        1.933        0.622
22       1.773        1.333        0.422        0.400        2.289        2.222        1.067
23       2.000        1.622        0.622        0.600        2.467        2.444        1.178
24       2.000        1.644        0.667        0.822        2.733        2.622        1.511
25       0.133        1.733        1.733        1.600        1.156        0.444        1.756
26       0.378        1.733        1.844        1.511        1.422        0.667        2.178
27       0.667        2.178        2.200        2.000        0.911        0.267        1.689
28       2.667        3.333        3.089        2.533        2.000        2.156        1.889
29       1.507        2.000        1.689        1.133        0.867        1.044        0.511
30       1.707        1.844        1.533        1.000        1.111        1.333        0.356
31       1.547        2.867        2.667        2.111        0.244        0.911        1.467
32       1.547        3.044        2.844        2.289        0.422        1.111        1.644
33       1.711        3.222        3.000        2.467        0.600        1.289        1.822
34       1.547        3.044        3.044        2.933        2.200        1.467        2.267
35       1.933        3.444        3.111        2.578        1.178        1.489        1.933
36       1.289        1.422        0.800        0.267        1.689        1.756        0.422
37       1.267        1.400        0.822        0.289        1.667        1.733        0.400
38       1.511        1.622        1.333        0.844        1.133        1.333        0.133
39       1.911        2.022        1.600        1.067        1.667        1.867        0.400
40       2.467        2.667        2.289        1.733        1.911        2.111        1.111
41       2.778        3.022        2.667        2.156        2.000        2.311        1.533
42       2.222        2.333        1.867        1.333        2.133        2.333        0.867
43       1.889        2.000        1.533        1.000        1.933        2.356        0.667    ;

table dik(i,k)

          1            2            3            4            5            6            7            8            9
1         1.333        1.756        2.311        2.533        2.089        1.511        2.400        2.422        2.000
2         0.867        1.822        2.400        2.622        1.733        1.156        2.044        2.511        2.111
3         0.133        1.111        1.667        1.889        1.244        0.667        1.556        1.778        1.378
4         0.089        0.889        1.444        1.667        1.222        0.644        1.533        1.556        1.156
5         0.311        1.067        1.622        1.844        1.444        0.867        1.756        1.733        1.333
6         0.733        0.311        0.867        1.022        1.867        1.289        1.111        0.911        0.511
7         0.822        0.400        0.956        0.911        1.800        1.378        1.022        0.822        0.422
8         1.200        0.222        0.378        0.756        2.356        1.756        1.644        1.444        1.044
9         1.378        0.400        0.867        1.244        2.533        1.933        1.822        1.622        1.222
10        1.578        0.600        1.089        1.444        2.733        2.156        2.044        1.822        1.422
11        1.756        0.889        1.378        1.756        2.689        2.089        2.333        2.133        1.733
12        1.667        0.689        1.178        1.533        2.756        2.156        2.133        1.911        1.511
13        1.356        0.378        0.178        0.556        2.511        1.911        1.800        1.489        1.022
14        0.556        0.711        1.089        1.489        1.689        1.111        1.578        1.378        0.978
15        1.689        0.711        0.333        0.600        2.622        2.244        1.844        1.378        1.844
16        1.578        0.600        0.222        0.489        2.511        2.133        1.733        1.422        0.956
17        1.622        0.644        0.267        0.533        2.556        2.178        1.778        1.467        1.000
18        1.822        0.844        0.356        0.733        2.756        2.378        1.978        1.667        1.200
19        1.822        0.844        0.311        0.533        2.467        2.400        1.689        1.400        0.911
20        1.667        0.844        0.311        0.089        2.156        2.222        1.378        1.089        0.600
21        1.467        1.044        0.644        0.489        1.889        2.000        1.133        0.733        0.267
22        1.756        0.956        0.400        0.222        2.267        2.311        1.489        1.178        0.711
23        1.978        1.156        0.600        0.422        2.444        2.533        1.689        1.289        0.911
24        2.156        1.178        0.644        0.667        2.711        2.733        1.933        1.622        1.156
25        0.222        1.178        1.756        1.956        1.133        0.556        1.444        1.867        1.467
26        0.356        1.333        1.889        2.089        1.378        0.800        1.689        2.289        1.600
27        0.711        1.689        2.244        2.467        0.889        0.311        1.200        1.800        1.956
28        2.622        2.844        3.044        2.889        1.933        2.044        1.422        2.000        2.289
29        1.511        1.444        1.667        1.489        0.844        0.933        0.067        0.600        0.889
30        1.711        1.311        1.511        1.356        1.089        1.200        0.333        0.467        0.733
31        1.378        2.333        2.622        2.444        0.222        0.800        1.000        1.578        1.844
32        1.556        2.533        2.800        2.644        0.400        1.000        1.178        1.756        2.022
33        1.733        2.711        2.956        2.800        0.578        1.178        1.333        1.933        2.200
34        1.533        2.511        3.067        3.311        2.156        1.578        1.800        2.378        2.800
35        1.933        2.867        3.089        2.933        1.156        1.378        1.444        2.044        2.311
36        1.289        0.867        0.778        0.622        1.689        1.778        0.911        0.533        0.044
37        1.267        0.844        0.800        0.644        1.667        1.756        0.889        0.511        0.044
38        1.511        1.089        1.289        1.133        1.111        1.222        0.333        0.244        0.533
39        1.911        1.489        1.578        1.400        1.644        1.756        0.867        0.311        0.711
40        2.467        2.044        2.267        2.089        1.889        2.000        1.133        1.222        1.489
41        2.756        2.467        2.689        2.533        1.978        2.200        1.444        1.644        1.911
42        2.222        1.800        1.844        1.667        2.133        2.222        1.356        0.778        1.000
43        1.889        1.467        1.511        1.356        1.933        2.022        1.156        0.778        0.667
;


table Dkl(k,l)
         1            2           3         4
1        1.2          1.9         1.125     1.475
2        0.1          0.875       2.1       1
3        0.625        0.25        2.325     1.05
4        1.05         1.275       2.15      0.875
5        2.5          2.45        0.35      1.725
6        1.825        2.6         0.5       1.875
7        1.7          1.575       0.5       0.875
8        1.5          1.275       1.2       0.45
9        1.05         0.7         1.4       0.1
;

table Djw(j,w)
         1            2           3            4
1        1.875        2           3.325        1.5
2        2.075        2.175       2.675        2.525
3        70.5         1.5         1.65         1.5
4        52.5         60          1.675        1.85
5        2            2           3            3
6        2.25         2.25        3            3.15
7        31.5         0.6         1.325        1.5


table Dlw(l,w)
         1            2               3             4
1        1.25         1.35416         1.875         1.66
2        1            1.10416         1.4583        1.270833
3        1.2916       1.35416         2.14583       2.33
4        0.33         0.4166          1.166         1.3125
;

table Daj(a,j)
          1             2          3           4             5          6           7
1         1.0833        0.366      1           1.433         1.866      1.3166      1.6166
2         1.766         1.5833     0.85        0.833         1.8        2           0.85
3         2             2.5333     2.3166      1.9           1.466      1.6166      1.4333
4         1.1833        1.2833     0.933       0.5           1.166      1.3166      0.2166
;

table Dal(a,l)
        1        2        3         4
1       0.7      1.2      1.733     1.433
2       1.25     0.66     1.55      0.783
3       2.2      2.1166   1.216     1.65
4       0.966    0.75     0.91666   0.2166
;


table Dau(a,u)
        1        2
1       0.7     1.2
2       1.2     0.6
3       2.2     2.1
4       0.9     0.7
;


table Dwu(w,u)
        1        2
1       0.7      1.2
2       1.2     0.6
3       2.2      2.1
4       0.9      0.7
;

table Duw(u,w)
        1        2    3     4
1      0.7     1.2   2.2   0.9
2      1.2     0.6   2.1   0.7
;


parameters
b
gl(l)
gj(j)
gu(u)
hj
hl
hu
ej(j)
el(l)
eu(u)
;

b     =normal(8,0.05);
gl(l) =normal(43930,1);
gj(j) =normal(1650,1);
gu(u) =normal(15000,1);
hj    =normal(0.218,0.0001);
hl    =normal(0.218,0.0001);
hu    =normal(0.218,0.0001);
ej(j) =normal(9,0.05);
el(l) =normal(9,0.05);
eu(u) =normal(9,0.05);




parameters
x(i)
Bk
Bj
Bl
Bw
Bu
Dij(i,j)
Dik(i,k)
Dkl(k,l)
Djw(j,w)
Dlw(l,w)
Daj(a,j)
Dal(a,l)
nn(a)
Qij
Qik
Qkl
Qjw
Qlw
Qwu
Quw
ok
oj
ol
ow
ou
ck
cj
cl
cu
wck(k)
wcj(j)
wcl(l)
wcw(w)
gamma
F(i)

;

gamma=6.278;
F(i) =107.267442 ;
Bk=1025;
Bj=1650 ;
Bl=1650;
Bu=850;
Bw=43930 ;
Qij=14.991416;
Qik=14.991416;
Qkl=29.982832;
Qjw=20.062042;
Qwu=20.062042;
Quw=20.062042;
Qlw=40.124084;
ok=2.20462;
oj=45.5474492;
ol=45.3600565;
ow=2;
ou=40.5;
ck=1;
cj=165139;
cl=802135;
cu=500000;


*cw=0;


*display gl,gj,ej,el,b,hj,hl;

binary variables
zk(k)
zj(j)
zl(l)
zw(w)
zu(u)
;

free variables
z1
z2
z3
zt
pr
;
integer variables
nij(i,j)
nik(i,k)
nkl(k,l)
njw(j,w)
nlw(l,w)
nwu(w,u)
nuw(u,w)
paj(a,j)
pal(a,l)
pau(a,u)
pj(j)
pl(l)
pu(u)
ptj(j)
ptl(l)
ptu(u)
;

positive variables
xij(i,j)
xik(i,k)
xkl(k,l)
yjw(j,w)
ylw(l,w)
tuw(u,w)
twu(w,u)
yw(w)
yw_all
commuting
conversion
transportation
costTrasportaion
;



equations
obj1
obj2
obj3
TotalObj

co1
co2
co3
co4
co6
co7
co8
co9
co10
co11
co15
cop15
co16
cop16
co17
cop17
co18
cop18
co19
cop19
co20
cop20
copp20
co21
cop21
copp21
co22
co24
co25
co27
co28
co31
co32
co100
co1000
co2000
co3000
co4000
co144
coz3
cozp3
cozpp3
cozppp3
co199
cop199
co119
cop119
co44
co1111
co999
co211
cop211
copp211
co288
cozpppp3
cozppppp3
co2333
co322


;



obj1     ..      z1 =e=p*(sum((i,j),xij(i,j))+sum((i,k),xik(i,k)))
                         +sum((i,j),c1*dij(i,j)*nij(i,j))+sum((i,k),c1*dik(i,k)*nik(i,k))
                         +sum((k,l),c2*dkl(k,l)*nkl(k,l))+sum((j,w),c3*djw(j,w)*njw(j,w))+sum((l,w),c4*dlw(l,w)* nlw(l,w))
                         +sum((w,u),c5*dwu(w,u)* nwu(w,u))+sum((u,w),c5*duw(u,w)* nuw(u,w))
                         +sum(k,ck*zk(k))+sum(l,cl*zl(l))+ sum(j,cj*zj(j))+ sum(w,cw(w)*zw(w)) + sum(u,cu*zu(u))
                         +[ok*sum((i,k),xik(i,k))]+[oj*sum((j,w),yjw(j,w))]
                         +[ol*sum((l,w),ylw(l,w))]+ [ow*sum(w,yw(w))] + [ou*sum((w,u),twu(w,u))];



obj2     ..      z2 =e= alpha*[(sum((a,j),daj(a,j)*paj(a,j))+sum((a,l),dal(a,l)*pal(a,l))+sum((a,u),dau(a,u)*pau(a,u)))]
                        +beta*[sum(w,yw(w))]  +teta*[sum((w,u),twu(w,u))]
                        +[gamma*sum((i,j),dij(i,j)*nij(i,j))]+[gamma*sum((i,k),dik(i,k)*nik(i,k))]
                        +[gamma*sum((k,l),dkl(k,l)*nkl(k,l))]+[gamma*sum((j,w),djw(j,w)*njw(j,w))]+[gamma*sum((l,w),dlw(l,w)*nlw(l,w))]
                        +[gamma*sum((w,u),dwu(w,u)*nwu(w,u))]+[gamma*sum((u,w),duw(u,w)*nuw(u,w))];


                        ;

obj3     ..      z3 =e=  sum(j,ptj(j))+sum(l,ptl(l))+sum(u,ptu(u))+[9*(sum(j,zj(j))+sum(l,zl(l))+sum(u,zu(u)))];




TotalObj        ..      ZT =e= [1/3*(z1/1318579)]+[1/3*(z2/1979)]-[1/3*(z3/418)];

co1(i)  ..      sum(j,xij(i,j))+sum(k,xik(i,k)) =g= f(i);
co2(k)  ..      sum(i,xik(i,k)) =l= Bk*zk(k);
co3(j)  ..      sum(i,xij(i,j)) =l= Bj*zj(j);
co4(l)  ..      sum(k,xkl(k,l)) =l= Bl*zl(l);
co44(u)  ..     sum(w,twu(w,u)) =l= Bu*zu(u);

co6(k)  ..      sum(i,xik(i,k)) =E= sum(l,xkl(k,l));
co7(w)  ..      landa*[sum(j,yjw(j,w))+sum(l,ylw(l,w))+sum(u,tuw(u,w))] =l= sum(u,twu(w,u));
co8(j)  ..    s*sum(i,xij(i,j)) =e= sum(w,yjw(j,w));
co9(l)  ..    s*sum(k,xkl(k,l)) =e= sum(w,ylw(l,w));
co999(u)  ..    delta*sum(w,twu(w,u)) =l= sum(w,tuw(u,w));
co100(w) ..     sum(l,ylw(l,w))+sum(j,yjw(j,w))+sum(u,tuw(u,w)) =l= Bw*zw(w);

co10(j) ..      sum(w,yjw(j,w)) =l= gj(j);
co11(l) ..      sum(w,ylw(l,w)) =l= gl(l);
co1111(u) ..    sum(w,tuw(u,w)) =l= gu(u);


co144(a) ..     sum(j,paj(a,j))+sum(l,pal(a,l))+sum(u,pau(a,u)) =L= nn(a);


*************************Linearization*********************************
co20(j)        ..    sum(a,paj(a,j))=g=ej(j)*zj(j)+[pj(j)];
cop20(j)       .. pj(j)=g= [sum(w,hj*yjw(j,w))/b]+eps;
copp20(j)      .. pj(j)=l= [sum(w,hj*yjw(j,w))/b]+1;

co21(l)        ..    sum(a,pal(a,l))=g=el(l)*zl(l)+[pl(l)];
cop21(l)       ..    pl(l)=g= [sum(w,hl*ylw(l,w))/b]+eps;
copp21(l)      ..   pl(l)=l= [sum(w,hl*ylw(l,w))/b]+1;

co211(u)       ..    sum(a,pau(a,u))=g=eu(u)*zu(u)+[pu(u)];
cop211(u)      ..    pu(u)=g= [sum(w,hu*twu(w,u))/b]+eps;
copp211(u)     ..   pu(u)=l= [sum(w,hu*twu(w,u))/b]+1;

co15(i,j)      ..      nij(i,j) =g= [xij(i,j)/qij]+eps;
cop15(i,j)     ..      nij(i,j) =l= [xij(i,j)/qij]+1;

co16(i,k)      ..      nik(i,k) =g= [xik(i,k)/qik]+eps;
cop16(i,k)     ..      nik(i,k) =l= [xik(i,k)/qik]+1;

co17(k,l)      ..      nkl(k,l) =g= [xkl(k,l)/qkl]+eps;
cop17(k,l)     ..      nkl(k,l) =l= [xkl(k,l)/qkl]+1;

co18(j,w)      ..      njw(j,w) =g= [yjw(j,w)/qjw]+eps;
cop18(j,w)     ..      njw(j,w) =l= {yjw(j,w)/qjw}+1;

co19(l,w)      ..      nlw(l,w) =g= [ylw(l,w)/qlw]+eps;
cop19(l,w)     ..      nlw(l,w) =l= [ylw(l,w)/qlw]+1;

co199(w,u)     ..      nwu(w,u) =g= [twu(w,u)/qwu]+eps;
cop199(w,u)    ..      nwu(w,u) =l= [twu(w,u)/qwu]+1;

co119(u,w)     ..      nuw(u,w) =g= [tuw(u,w)/quw]+eps;
cop119(u,w)    ..      nuw(u,w) =l= [tuw(u,w)/quw]+1;


coz3(j)        ..      ptj(j)=g= [(hj*sum(w,yjw(j,w)))/b]+eps;
cozp3(j)       ..      ptj(j)=l= [(hj*sum(w,yjw(j,w)))/b]+1;
cozpp3(l)      ..      ptl(l)=g= [(hl*sum(w,ylw(l,w)))/b]+eps;
cozppp3(l)     ..      ptl(l)=l= [(hl*sum(w,ylw(l,w)))/b]+1;
cozpppp3(u)    ..      ptu(u)=g= [(hu*sum(w,twu(w,u)))/b]+eps;
cozppppp3(u)   ..      ptu(u)=l= [(hu*sum(w,twu(w,u)))/b]+1;


*************************Additional Constraints************************

co22(j)   ..      sum(a,paj(a,j)) =l= M*zj(j);
co2333(u) ..      sum(a,pau(a,u)) =l= M*zu(u);
co24(k)  ..      sum(i,xik(i,k)) =l= M*zk(k);
co25(j)  ..      sum(i,xij(i,j)) =l= M*zj(j);
co27(w)  ..      sum(j,yjw(j,w)) =l= M*zw(w);
co28(w)  ..      sum(l,ylw(l,w)) =l= M*zw(w);
co288(u) ..      sum(w,twu(w,u)) =l= M*zu(u);
co31(w)  ..      sum(j,yjw(j,w)) =l= wh(w);
co32(w)  ..      sum(l,ylw(l,w)) =l= wh(w);
co322(w) ..      sum(u,tuw(u,w)) =l= wh(w);



***************************Additional Results**************************
co1000    ..      yw_all=e=sum(w,yw(w)) ;

co2000   ..       commuting  =e=  alpha*[(sum((a,j),daj(a,j)*paj(a,j))+sum((a,l),dal(a,l)*pal(a,l))+sum((a,u),dau(a,u)*pau(a,u)))] ;
co3000   ..       conversion =e=  beta*[sum(w,yw(w))] +teta*[sum((u,w),tuw(u,w))] ;
co4000   ..       transportation =e=  [gamma*sum((i,j),dij(i,j)*nij(i,j))]+[gamma*sum((i,k),dik(i,k)*nik(i,k))]  +[gamma*sum((k,l),dkl(k,l)*nkl(k,l))]+[gamma*sum((j,w),djw(j,w)*njw(j,w))]+[gamma*sum((l,w),dlw(l,w)*nlw(l,w))] +[gamma*sum((w,u),dwu(w,u)*nwu(w,u))]+[gamma*sum((u,w),duw(u,w)*nuw(u,w))];

***************************************************************


model   RealSample   /all/

options
optca=0
optcr=0
reslim=500000
limrow=10000
limcol=10000
MIP=CPLEX
decimals=8
;


solve RealSample using MIP minimizing zt ;
display ZT.l,z1.l,z2.l,z3.l,zk.l,pau.l,paj.l,pal.l,zj.l,zu.l,zl.l,zw.l,xij.l,xik.l,xkl.l,yjw.l,tuw.l,twu.l,ylw.l,yw.l,nij.l,nik.l,nkl.l,njw.l,nlw.l,nwu.l,nuw.l,yw_all.l,commuting.l,conversion.l,transportation.l




